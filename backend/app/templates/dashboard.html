{% extends "layout.html" %}
{% block content %}
    <section class="dashboard">
        <h2>Welcome, {{ current_user.username }}!</h2>
        <p>Here's an overview of your mental health journey.</p>

        <!-- Date Range Filter -->
        <div class="filter-section">
            <label for="date-range">Filter by Date Range:</label>
            <input type="date" id="start-date" name="start-date">
            <input type="date" id="end-date" name="end-date">
            <button class="btn" onclick="filterMoodData()">Filter</button>
        </div>

        <!-- Mood Overview Chart -->
        <div class="chart-container">
            <h3>Your Mood Trends</h3>
            <div id="mood-chart" style="width: 100%; height: 400px;"></div>
        </div>

        <!-- Mood Assessments Summary -->
        <div class="assessments-section">
            <h3>Recent Assessments</h3>
            <table class="assessment-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Anxiety</th>
                        <th>Depression</th>
                        <th>Schizophrenia</th>
                        <th>Bipolar</th>
                        <th>Prediction</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment in assessments %}
                        <tr>
                            <td>{{ assessment.date }}</td>
                            <td>{{ assessment.anxiety }}</td>
                            <td>{{ assessment.depression }}</td>
                            <td>{{ assessment.schizophrenia }}</td>
                            <td>{{ assessment.bipolar }}</td>
                            <td>{{ assessment.prediction }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Prediction Insights -->
        <div class="prediction-insights">
            <h3>Insights Based on Your History</h3>
            <p>Based on your previous assessments, we suggest the following techniques:</p>
            <ul>
                <li>Consider relaxation exercises like mindful breathing and yoga</li>
                <li>Engage in cognitive behavioral therapy (CBT) practices</li>
                <li>Stay consistent with self-assessments to track progress</li>
            </ul>
        </div>

        <!-- Suggest Relaxation Techniques -->
        <div class="suggestions-section">
            <h3>Suggestions for Improving Mental Health</h3>
            <p>Here are some recommended relaxation techniques:</p>
            <a href="{{ url_for('relaxation') }}" class="btn">Explore Relaxation Techniques</a>
        </div>
    </section>

    <!-- Include Plotly.js or Chart.js for rendering charts -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Sample data for the chart (Replace with real data from backend)
        var data = [{
            x: ['2024-09-01', '2024-09-15', '2024-09-30', '2024-10-15'],
            y: [3, 5, 2, 4],  // Example: Mood scores (1-5 scale)
            type: 'scatter',
            mode: 'lines+markers',
            marker: { color: 'blue' },
            name: 'Mood Score'
        }];

        var layout = {
            title: 'Mood Trend Over Time',
            xaxis: { title: 'Date' },
            yaxis: { title: 'Mood Score (1-5)', range: [0, 5] }
        };

        Plotly.newPlot('mood-chart', data, layout);

        // Function to filter mood data (e.g., by date range)
        function filterMoodData() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            // Implement logic to filter the chart data based on selected date range
            // Fetch filtered data from the backend and update the chart dynamically
            console.log('Filter data from:', startDate, 'to', endDate);
        }
    </script>
{% endblock %}
